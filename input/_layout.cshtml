@{
	var title = Document.GetString("Title") ?? Document.GetString("SiteTitle");
    var isPost = Document.GetBool("IsPost") && title != "Tags" && title != "Archive";
}
<!DOCTYPE html>
<html class="has-background-light" lang="ja">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  @if(Document.ContainsKey(WebKeys.Description))
  {
    <meta name="description" content="@Document.GetString(WebKeys.Description)">
  }
  @if(Document.ContainsKey(WebKeys.Author))
  {
    <meta name="author" content="@Document.GetString(WebKeys.Author)">
  }

  <title>@Document.GetString("PageTitle")</title>

  <link rel="canonical" href="@(Document.GetString("Canonical") ?? Document.GetLink(true))">

  @{
    @foreach (IDocument rssFeed in Outputs["**/*.rss"])
    {
      <link type="application/rss+xml" rel="alternate" title="@rssFeed.GetString(WebKeys.Title)" href="@rssFeed.GetLink()" />
    }
    @foreach (IDocument atomFeed in Outputs["**/*.atom"])
    {
      <link type="application/atom+xml" rel="alternate" title="@atomFeed.GetString(WebKeys.Title)" href="@atomFeed.GetLink()" />
    }
  }
  
  <meta name="application-name" content="@Document.GetString("SiteTitle")" />
  <meta name="msapplication-tooltip" content="@Document.GetString("SiteTitle")" />
  <meta name="msapplication-starturl" content="@Context.GetLink("/")" />

  <meta property="og:title" content="@Document.GetString("PageTitle")" />
  @if (Document.ContainsKey(WebKeys.Image))
  {
    <meta property="og:image" content="@Context.GetLink(Document.GetString(WebKeys.Image))" />
  }
  <meta property="og:type" content="website" />
  <meta property="og:url" content="@Document.GetLink(true)" />
  
  <link rel="shortcut icon" href="@Context.GetLink("/favicon.ico")" type="image/x-icon">
  <link rel="icon" href="@Context.GetLink("/favicon.ico")" type="image/x-icon">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
  
  <link href="@Context.GetLink("/css/blog.css")" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.19.0/themes/prism.css">

  <!-- Lunr search -->
  @if (Context.GetBool(WebKeys.GenerateSearchIndex))
  {
    <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.0.3/dist/pako_inflate.min.js"></script>
    <script src="@(Context.GetLink(Context.GetPath(WebKeys.SearchScriptPath, "search.js")))"></script>
  }
  
  @RenderSection("Head", false)
</head>

<body>

  <!-- Navigation -->
  @RenderSectionOrPartial("Navigation", "_navigation")

  <!-- Main Content -->
		<div class="section">
			<div class="container">
				<div class="columns is-desktop">
					<div class="column is-three-quarters">
						<main>
							@if(isPost){
								var articleTags = Document.Get<List<string>>("Tags");
								<article class="card mb-6">
									<header>
										<div class="card-content pb-0">
											<h1 class="title mb-4">
												@Html.DocumentLink(Document)
											</h1>
											<div class="columns mt-0 mb-0 is-vcentered">
												<div class="column is-narrow pt-0">
													<div class="columns is-mobile is-vcentered">
														<div class="column is-narrow pr-0 is-flex">
															<span class="icon">
																<i class="fas fa-calendar-alt"></i>
															</span>
														</div>
														<time class="column pl-0 is-narrow">
															<span>@Document.GetDateTime(WebKeys.Published).ToLongDateString()</span>
														</time>
													</div>
												</div>
												<div class="column pt-0">
													<div class="columns is-mobile is-vcentered">
														<div class="column is-narrow pr-0 is-flex">
															<span class="icon">
																<i class="fas fa-tags"></i>
															</span>
														</div>
														<ul class="column tags pl-0">
															@foreach(var tag in articleTags){
																<li class="tag is-link is-light">
																	<a class="has-text-dark" href="@Context.GetLink($"/tags/{tag}")">@tag</a>
																</li>
															}
														</ul>
													</div>
												</div>
											</div>
										</div>
									</header>
									
									<div class="card-content pt-0">
										<div class="content">
											@RenderBody()
										</div>
									</div>
								</article>
							}else{
								@RenderBody()
							}
						</main>
					</div>
					<div class="column">
						<!-- Side -->
						<aside>
							<div class="has-text-centered">
								<img src="@Context.GetLink("/img/icon.png")" width="100px" height="100px" loading="lazy">
								<h1 class="title is-5">ひつじのひと</h1>
							</div>
							<div class="content mb-3">
								<p class="mt-5">ひつじの皮をかぶったひと。 フリーランスなう。</p>
							</div>
							<div>
								<ul class="level is-mobile">
									<li class="level-item">
										<a href="">
											<span class="icon is-medium">
												<i class="fas fa-user-circle fa-2x has-text-black"></i>
											</span>
										</a>
									</li>
									<li class="level-item">
										<a href="https://twitter.com/hitsuji_no_hito">
											<span class="icon is-medium">
												<i class="fab fa-twitter fa-2x has-text-black"></i>
											</span>
										</a>
									</li>
									<li class="level-item">
										<a href="https://github.com/Ovis">
											<span class="icon is-medium">
												<i class="fab fa-github fa-2x has-text-black"></i>
											</span>
										</a>
									</li>
								</ul>
							</div>
						</aside>
						<aside class="mt-5">
							<h1 class="title is-5">最新記事</h1>
							<nav class="panel">
								@foreach(var article in Outputs.Get("posts.html").GetChildren().OrderByDescending(x => x.GetDateTime(WebKeys.Published)).Take(5)){
									<a class="panel-block" href="@Context.GetLink(article)">
										<span class="panel-icon">
											<i class="fas fa-book" aria-hidden="true"></i>
										</span>@article.GetTitle()
									</a>
								}
							</nav>
						</aside>
						<aside class="mt-5">
							<h1 class="title is-5">タグ</h1>
							<nav class="panel">
								@{
						                IDocument[] tags = Outputs.Get("tags.html")?.GetChildren().OrderByDescending(x => x.GetChildren().Count()).Take(10).ToArray() ?? Array.Empty<IDocument>();
						                if (tags.Length > 0)
						                {
						                        @foreach (IDocument tag in Outputs.Get("tags.html").GetChildren().OrderByDescending(x => x.GetChildren().Count()).Take(10))
						                        {
						                            string postCount = tag.GetChildren().Count().ToString();
													<a class="panel-block" href="@Context.GetLink(tag)">
														<span class="panel-icon">
															<i class="fas fa-book" aria-hidden="true"></i>
														</span>
														<span>
															@tag.GetTitle() (@postCount)
														</span>
													</a>
						                        }
						                }
						            }
							</nav>
						</aside>
						<aside class="mt-5">
							<h1 class="title is-5 mb-1">検索</h1>
							<div class="panel-block">
								<form action="/search" method="GET">
									<p class="control has-icons-left">
										<input class="input" type="text" placeholder="Search" name="query">
										<span class="icon is-left">
											<i class="fas fa-search" aria-hidden="true"></i>
										</span>
									</p>
								</form>
							</div>
						</aside>
						<aside class="mt-5 ml-2">
				            <ul>
				                @{
				                    IDocument rssFeed = Outputs["**/*.rss"].FirstOrDefault();
				                    IDocument atomFeed = Outputs["**/*.atom"].FirstOrDefault();
				                }
				                @if (rssFeed != null) {
				                    <li>
				                        <a href="@Context.GetLink(rssFeed)"><i class="fa fa-rss"></i> RSS Feed</a>
				                    </li>
				                }
				                @if (atomFeed != null) {
				                    <li>
				                        <a href="@Context.GetLink(atomFeed)"><i class="fa fa-rss"></i> Atom Feed</a>
				                    </li>
				                }
				            </ul>
						</aside>
					</div>
				</div>
			</div>
		</div>

  <!-- Footer -->  
  @RenderSectionOrPartial("Footer", "_footer")

	@Html.Partial("_scripts")
	@RenderSection("Scripts", false)
</body>

</html>
